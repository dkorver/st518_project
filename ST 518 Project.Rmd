---
title: "ST 518 Project"
author: "Rachel Hencher, Dane Korver, Mohammed Mira"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    toc: true
---

```{r setup, include = FALSE}
library(readr)
library(knitr)
library(dplyr)
library(GGally)
library(ggplot2)
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

# Executive Summary  
*A one or two paragraph summary that includes a description of the experiment, significant results (including any interesting numerical results), and any conclusions you draw. The reader should be able to glean all the important aspects of your work from the executive summary. Effectively and succinctly convey objectives, summary of experimental design, and results and conclusions drawn from experiment.*  


# Introduction  
*Explain what you are trying to learn from the experiment -- you may borrow heavily from my description. Effectively describe the purpose of the experiment.*  

The purpose of this experiment is to investigate specific factors and their effect on the amount of time it takes to dissolve a cold medicine tablet in water. The data is from an “Effervescent Experiment” designed to compare dissolving times of two different brands of tablets (name brand and store brand) at three different equally spaced water temperatures (6$^\circ$C, 23$^\circ$C, and  40$^\circ$C). The run order number, as well as whether or not the sample was stirred, were also recorded and are investigated in the analysis portions of this report.  

Below, we have a brief look at the first 10 of 48 rows of data in order to begin to gain an understanding of the data set we are working with.  

```{r data}
data <- read_csv("effervescence.csv")
data$Brand <- as.factor(data$Brand)
data$Stirred <- as.factor(data$Stirred)
data$Temp <- as.factor(data$Temp)
data$Order <- as.factor(data$Order)
kable(head(data, n = 10), caption = "First 10 Rows of Effervescence Data")
```


# Experimental Design  
*Include a description of the experiment and the data that was collected -- you may borrow heavily from my description. Effectively describe the experimental design and factors.*   

The experiment carried out was a complete block design where *b* = 2 blocks (by stirred status) were selected with *n* = 4 observations on each of the treatment combinations in each block. In Block I, the water was stirred using a magnetic stirring plate at 350 revolutions per minute, whereas in Block II, the water was not stirred. The time for the tablet to dissolve was measured from the moment the tablet was dropped into the water to the time the tablet was completely dissolved. Each tablet was dropped from a fixed height into 60mL of water. The observation was taken as an average of the times as measured by four experimenters and was recorded, along with the run order for each observation.  


# Exploratory Analysis  

Summary statistics for each variable can be seen below. For the `Brand`, `Temp`, `Stirred`, and `Order` variables, we can see counts for each level. For the `Time` variable, we can see a five-number summary for the variable.  

```{r summary stats}
kable(summary(data), caption = "Summary Stats for Variables", digits = 2)
```

The Summary Stats for Time by Group Table shows a decrease in dissolving time as Temp increases regardless of Brand or Stirred status.  There doesn't appear to be a trend between Name and Store Brand.  For example, when the water was stirred for the Name Brand at Temp 6, 20 and 40, the mean was 76.2, 72.69, and 65.85, respectively.  When the water was stirred for the Store Brand at Temp 6, 20 and 40, the mean was 77.34, 66.12, and 59.13, respectively.  Name Brand generally had a higher dissolving time, but occasionally, Store Brand would have a higher dissolve time than Name Brand.  The same was for when the water was not Stirred, both instances at the 6 degree Temp.  There was also some unusally high standard deviations for Name Brand at the 23 and 40 degree Temps with their standard deviations at 2.64 and 1.6, respectively.  Both instances where the water was Stirred.  Store Brand at 6 degree Temp, not Stirred had a standard deviation of 1.3.  The standard deviations tended to range between 0.2 and 0.77.         

```{r addtl summary stats}
data_stats <- data %>%
                as_tibble() %>%
                group_by(Brand, Stirred, Temp) %>%
                summarise_at(vars(Time), list(Mean = mean, 
                                              SD = sd,
                                              Min = min, 
                                              Q1 = ~quantile(., probs = 0.25), 
                                              Median = median, 
                                              Q3 = ~quantile(., probs = 0.75), 
                                              Max = max))
kable(data_stats, caption = "Summary Stats for Time by Group", digits = 2)
```

The box plot below displays a five-number summary of dissolving time for each brand of tablet. The plot displays `Time` as a function of `Brand` and indicates that there is an effect of the brand on time.  

```{r box plot time v brand, fig.align = 'center', out.width = "300px"}
ggplot(data, aes(x = Brand, y = Time)) + 
  geom_boxplot(fill = "cornflowerblue") + 
  labs(title = "Tablet Dissolve Time for Brand", x = "Brand", y = "Time (in seconds)") +        scale_x_discrete(labels = c("Name", "Store")) +
  theme(plot.title = element_text(hjust = 0.5))
```

The box plot below displays a five-number summary of dissolving time for each stirred status. The box plot displays `Time` as a function of `Stirred` and indicates that there is an effect of the stirred status on time.  

```{r box plot time v stirred status, fig.align = 'center', out.width = "300px"}
ggplot(data, aes(x = Stirred, y = Time)) + 
  geom_boxplot(fill = "cornflowerblue") + 
  labs(title = "Tablet Dissolve Time for Stirred Status", x = "Stirred Status", y = "Time (in seconds)") + scale_x_discrete(labels = c("No", "Yes")) +
  theme(plot.title = element_text(hjust = 0.5))
```

The box plot below displays the dissolving time for different water temperatures. `Time` is displayed as a function of `Temperature`, however, we can also see how the `Brand` and `Stirred` variables affect the dissolving time by observing the color and shape of the points. It is clear that a warmer temperature reduces the dissolving time. It also appears that, as mentioned above, stirring the water reduces the dissolving time and that at the higher temperatures, the store brand dissolves more quickly than the name brand tablets.   

```{r box plot time v temp, fig.align = 'center', out.width = "400px"}
ggplot(data, aes(x = Temp, y = Time)) + 
  geom_boxplot() + 
  geom_point(aes(color = Stirred, shape = Brand)) + 
  labs(title = "Tablet Dissolve Time for Water Temperature", 
       x = "Temperature (in degrees Celcius)", 
       y = "Time (in seconds)") + 
  scale_shape_discrete(labels = c("Name", "Store")) + 
  scale_color_manual(values = c("cornflowerblue", "blue4"), labels = c("No", "Yes")) +
  theme(plot.title = element_text(hjust=0.5))
```


# Analysis and Results  
*Fit appropriate models and follow good statistical analysis process to determine the best model to use. Make use of proper diagnostics. Choose the appropriate effects to compare, correctly estimate and test significance of the effects and trends.*  

**Model 1**  

```{r no interaction model, fig.align = 'center', out.width = "300px"}
amod1 <- aov(Time ~ Brand + Temp + Stirred, data = data)
par(mfrow = c(2,2), mar = c(2, 2, 2, 2))
plot(amod1, pch = 19)
par(mfrow = c(1,1), mar = c(5.1, 4.1, 4.1, 2.1))
summary(amod1)
```

**Coefficients of Model 1**  

```{r model1 coefficients}
coefficients(amod1)
```

**Model 2**  

```{r interaction model, fig.align = 'center', out.width = "300px"}
amod2 <- aov(Time ~ Brand*Temp*Stirred, data = data)
par(mfrow = c(2,2), mar = c(2, 2, 2, 2))
plot(amod2, pch = 19)
par(mfrow = c(1,1), mar = c(5.1, 4.1, 4.1, 2.1))
summary(amod2)
```

**Coefficients of Model 2**  

```{r model2 coefficients}
coefficients(amod2)
```

**Model 3**  

```{r significant terms model, fig.align = 'center', out.width = "300px"}
amod3 <- aov(Time ~ Brand + Temp + Stirred + Brand:Temp + Brand:Stirred, data = data)
par(mfrow = c(2,2), mar = c(2, 2, 2, 2))
plot(amod3, pch = 19)
par(mfrow = c(1,1), mar = c(5.1, 4.1, 4.1, 2.1))
summary(amod3)
```

**Coefficients of Model 3**  

```{r model3 coefficients}
coefficients(amod3)
```

**Model selection by AIC criterion**  

```{r model selection}
library(AICcmodavg)
model_set <- list(amod1, amod2, amod3)
model_names <- c("Model 1", "Model 2", "Model 3")
aictab(model_set, modnames = model_names)
```

**Tukey's**  

```{r}
TukeyHSD(aov(Time ~ Brand + Temp, data = data))
```

**Using Order as a covariate with Time**  

When we graph the Order variable with respect to Time and group it by Stirred, there appears to be a linear association between the two blocks, albeit weak, but when we look at the two blocks separately, we can see the potential of using Order as a covariate to assist us in determining if there is a difference in dissolving times between the two blocks.

```{r, echo = FALSE, eval = TRUE, fig.align='center', out.width = "300px"}
knitr::include_graphics("figure_for_project.png")
```  

For Block 1, where the liquid was stirred, there appears to be a downward linear trend in the dissolving time of the cold medicine tablets. For Block 2, where the liquid was not stirred, there appears to be an upward linear trend in the dissolving time of the cold medicine tablets. Since the Order variable directly matches the Stirred variable, meaning the first 24 values of Order coincide with Block 1 and the second 24 values of Order coincide with Block 2 and the slopes for the two Blocks are not moving in the same direction as we can observe looking at our initial graph, we can write our model as follows: 
  
Time = Mean + Brand + Temp + Brand*Temp + Error
  
When we look at our model for Block 1 and Block 2, we see that our regression slopes are not all equal to 0 given the p-values (<0.001) for both models are less than our significance level of 0.05 and that there is a significant interaction effect. Since we have different slopes we can look at the differences between Brand and Temp at the different levels. For both Blocks, we can see that there was not a significant difference between the Brands at 6 degrees Celsius.

Output for Stirred=No.  
```{r, echo = FALSE, eval = TRUE, fig.align='center', out.width = "300px"}
knitr::include_graphics("stirred_no.png")
``` 

Output for Stirred=Yes.
```{r, echo = FALSE, eval = TRUE, fig.align='center', out.width = "300px"}
knitr::include_graphics("stirred_yes.png")
``` 

# Conclusion  
*Effectively describe conclusions and reasons for recommendation, analysis limitations, and future work. Address the proper role of the Stirred variable in this analysis.*  
 

